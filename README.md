# Flight Tracker Bot

Telegram –±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–≤–∏–∞–±–∏–ª–µ—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Aviasales API –∏ OpenAI –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```env
TELEGRAM_TOKEN=your_telegram_bot_token
OPENAI_API_KEY=your_openai_api_key
AVIASALES_TOKEN=your_aviasales_token
REDIS_URL=redis://localhost:6379
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
./start_server.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
python3 -m uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook
```bash
python3 scripts/set_webhook.py https://flytrackerbot.loca.lt/tg/webhook
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ core/           # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ bot.py     # Telegram webhook handler
‚îÇ   ‚îú‚îÄ‚îÄ openai_agent.py  # AI –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ conversation_state.py  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–∏–∞–ª–æ–≥–∞
‚îÇ   ‚îî‚îÄ‚îÄ dialog_memory.py  # –ü–∞–º—è—Ç—å –¥–∏–∞–ª–æ–≥–æ–≤
‚îú‚îÄ‚îÄ services/       # –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ aviasales_search.py  # –ü–æ–∏—Å–∫ –±–∏–ª–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ redis_client.py  # Redis –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ extract_params.py  # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ config/         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ llm_config.py  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ OpenAI
‚îî‚îÄ‚îÄ main.py         # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

scripts/            # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ set_webhook.py  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook
‚îî‚îÄ‚îÄ reset_webhook.py  # –°–±—Ä–æ—Å webhook

tests/              # –¢–µ—Å—Ç—ã
```

## ü§ñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

–ë–æ—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∏ –º–æ–∂–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞:

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
- `–ú–æ—Å–∫–≤–∞ –ù—è—á–∞–Ω–≥ 25.07.2025`
- `–ò–∑ –ú–æ—Å–∫–≤—ã –≤ –ë–∞–Ω–≥–∫–æ–∫ –≤ –∏—é–ª–µ`
- `–ë–∏–ª–µ—Ç—ã –ú–æ—Å–∫–≤–∞ - –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –Ω–∞ –∑–∞–≤—Ç—Ä–∞`
- `–ü–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤ –ú–æ—Å–∫–≤–∞ –ß–µ–ª—è–±–∏–Ω—Å–∫ –±–µ–∑ –ø–µ—Ä–µ—Å–∞–¥–æ–∫`

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞:
- **–û—Ç–∫—É–¥–∞** (`from`): –≥–æ—Ä–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–ö—É–¥–∞** (`to`): –≥–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è  
- **–î–∞—Ç–∞** (`date`): –¥–∞—Ç–∞ –≤—ã–ª–µ—Ç–∞
- **–ü–µ—Ä–µ—Å–∞–¥–∫–∏** (`transfers`): –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å–∞–¥–æ–∫

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ webhook:
```bash
python3 scripts/set_webhook.py
```

### –°–±—Ä–æ—Å webhook:
```bash
python3 scripts/reset_webhook.py
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:
```bash
pkill -f uvicorn
pkill -f localtunnel
```

## üìä API Endpoints

- `GET /` - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `POST /tg/webhook` - Telegram webhook
- `GET /docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
python3 -m pytest tests/

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –∞–≥–µ–Ω—Ç–∞
python3 tests/test_agent.py

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
python3 tests/test_conversation.py
```

## üîç –û—Ç–ª–∞–¥–∫–∞

–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:
- –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Telegram
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ AI
- –ü–æ–∏—Å–∫ –±–∏–ª–µ—Ç–æ–≤
- –û—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

## üìù –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+
- Redis —Å–µ—Ä–≤–µ—Ä
- Telegram Bot Token
- OpenAI API Key
- Aviasales API Token

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ LibreSSL (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- Deprecation warnings –æ—Ç LangChain (–±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö)
